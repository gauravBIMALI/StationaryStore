@model ClzProject.Models.BuyerContactMessage

@{
    ViewData["Title"] = "Reply to Buyer";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0"><i class="fas fa-reply me-2"></i>Reply to Buyer Message</h4>
                </div>
                <div class="card-body">
                    <!-- Buyer Information Summary -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6 class="card-title text-primary"><i class="fas fa-user me-2"></i>Buyer Information</h6>
                                    <p class="mb-1"><strong>Name:</strong> @Model.Name</p>
                                    <p class="mb-1"><strong>Email:</strong> @Model.Email</p>
                                    <p class="mb-1"><strong>Phone:</strong> @Model.PhoneNumber</p>
                                    <p class="mb-0"><strong>Business:</strong> @Model.BusinessName (@Model.BusinessType)</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h6 class="card-title text-info"><i class="fas fa-info-circle me-2"></i>Submission Details</h6>
                                    <p class="mb-1"><strong>Location:</strong> @Model.Location</p>
                                    <p class="mb-1"><strong>Age:</strong> @Model.Age years</p>
                                    <p class="mb-0"><strong>Submitted:</strong> @Model.SubmittedAt.ToString("MMM dd, yyyy hh:mm tt")</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Quick View -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary"><i class="fas fa-file-alt me-2"></i>Documents</h6>
                            <div class="d-flex gap-3">
                                <a asp-action="ViewDocument" asp-route-id="@Model.Id" asp-route-docType="citizenship"
                                   target="_blank" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-id-card me-1"></i>View Citizenship
                                </a>
                                <a asp-action="ViewDocument" asp-route-id="@Model.Id" asp-route-docType="pan"
                                   target="_blank" class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-file-invoice me-1"></i>View PAN
                                </a>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- Reply Form -->
                    <form asp-action="Reply" method="post">
                        <input type="hidden" name="id" value="@Model.Id" />
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                        <div class="mb-3">
                            <label for="adminReply" class="form-label">
                                <strong>Your Reply Message <span class="text-danger">*</span></strong>
                            </label>
                            <textarea name="adminReply" id="adminReply" class="form-control" rows="8"
                                      placeholder="Type your reply message to the buyer here..."></textarea>
                            <div class="form-text">This message will be sent to @Model.Email</div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Back to Messages
                            </a>
                            <div>
                                <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-outline-info me-2">
                                    <i class="fas fa-eye me-1"></i>View Full Details
                                </a>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-paper-plane me-1"></i>Send Reply
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Auto-resize textarea
        document.getElementById('adminReply').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });

        // Confirm before sending reply
        document.querySelector('form').addEventListener('submit', function(e) {
            const reply = document.getElementById('adminReply').value.trim();
            if (reply === '') {
                e.preventDefault();
                alert('Please enter a reply message before sending.');
                return;
            }

            if (!confirm('Are you sure you want to send this reply? This action cannot be undone and the message will be removed from the pending list.')) {
                e.preventDefault();
            }
        });
    </script>
}