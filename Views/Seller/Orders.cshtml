@model List<ClzProject.ViewModels.SellerOrderViewModel>

@{
    ViewData["Title"] = "Manage Orders";
    var currentStatus = ViewBag.CurrentStatus as string ?? "All";
}

<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h2><i class="fas fa-shopping-bag text-primary me-2"></i>Manage Orders</h2>
            
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show">
            <i class="fas fa-check-circle me-2"></i>@TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show">
            <i class="fas fa-exclamation-triangle me-2"></i>@TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Filter Tabs -->
    <div class="card mb-4">
        <div class="card-body">
            <ul class="nav nav-pills">
                <li class="nav-item">
                    <a class="nav-link @(currentStatus == "All" ? "active" : "")"
                       asp-action="Orders" asp-route-status="All">
                        <i class="fas fa-list me-2"></i>All Orders
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(currentStatus == "Pending" ? "active" : "")"
                       asp-action="Orders" asp-route-status="Pending">
                        <i class="fas fa-clock me-2"></i>Pending
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(currentStatus == "Confirmed" ? "active" : "")"
                       asp-action="Orders" asp-route-status="Confirmed">
                        <i class="fas fa-check me-2"></i>Confirmed
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(currentStatus == "Shipped" ? "active" : "")"
                       asp-action="Orders" asp-route-status="Shipped">
                        <i class="fas fa-shipping-fast me-2"></i>Shipped
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(currentStatus == "Delivered" ? "active" : "")"
                       asp-action="Orders" asp-route-status="Delivered">
                        <i class="fas fa-check-circle me-2"></i>Delivered
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(currentStatus == "Cancelled" ? "active" : "")"
                       asp-action="Orders" asp-route-status="Cancelled">
                        <i class="fas fa-times-circle me-2"></i>Cancelled
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- Orders Table -->
    @if (Model.Any())
    {
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>
                    @(currentStatus == "All" ? "All Orders" : currentStatus + " Orders")
                    (@Model.Count)
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Image</th>
                                <th>Order Details</th>
                                <th>Product</th>
                                <th>Customer Info</th>
                                <th>Delivery Address</th>
                                <th>Amount</th>
                                <th>Payment</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var order in Model)
                            {
                                <tr>
                                    <!-- Product Image -->
                                    <td>
                                        @if (!string.IsNullOrEmpty(order.ProductImage))
                                        {
                                            <img src="data:image/jpeg;base64,@order.ProductImage"
                                                 alt="@order.ProductName"
                                                 class="rounded"
                                                 style="width: 60px; height: 60px; object-fit: cover;">
                                        }
                                        else
                                        {
                                            <div class="bg-light rounded d-flex align-items-center justify-content-center"
                                                 style="width: 60px; height: 60px;">
                                                <i class="fas fa-image text-muted"></i>
                                            </div>
                                        }
                                    </td>

                                    <!-- Order Details -->
                                    <td>
                                        <p class="mb-1">
                                            <strong class="text-primary">@order.OrderNumber</strong>
                                        </p>
                                        <small class="text-muted">
                                            <i class="fas fa-calendar me-1"></i>
                                            @order.OrderDate.ToString("dd MMM yyyy")
                                        </small>
                                        <br>
                                        <small class="text-muted">
                                            <i class="fas fa-clock me-1"></i>
                                            @order.OrderDate.ToString("hh:mm tt")
                                        </small>
                                    </td>

                                    <!-- Product Info -->
                                    <td>
                                        <p class="mb-1 fw-semibold">@order.ProductName</p>
                                        <small class="text-muted">Qty: @order.Quantity</small>
                                    </td>

                                    <!-- Customer Info -->
                                    <td>
                                        <p class="mb-1">
                                            <i class="fas fa-user me-1 text-muted"></i>
                                            <strong>@order.DeliveryName</strong>
                                        </p>
                                        <small class="text-muted">
                                            <i class="fas fa-phone me-1"></i>
                                            @order.DeliveryPhone
                                        </small>
                                    </td>

                                    <!-- Delivery Address -->
                                    <td>
                                        <small>
                                            <i class="fas fa-map-marker-alt me-1 text-danger"></i>
                                            @order.DeliveryAddress<br>
                                            @order.DeliveryCity
                                            @if (!string.IsNullOrEmpty(order.DeliveryState))
                                            {
                                                <text>, @order.DeliveryState</text>
                                            }
                                        </small>
                                    </td>

                                    <!-- Amount -->
                                    <td>
                                        <p class="mb-0 fw-bold text-success">
                                            Rs. @((order.Total * 0.95m).ToString("N2"))
                                        </p>
                                        <small class="text-muted">
                                            <del>Rs. @order.Total.ToString("N2")</del>
                                            <span class="text-danger">-5%</span>
                                        </small>
                                    </td>

                                    <!-- Payment Method -->
                                    <td>
                                        <span class="badge bg-info">
                                            <i class="fas fa-money-bill-wave me-1"></i>
                                            @order.PaymentMethod
                                        </span>
                                    </td>

                                    <!-- Status -->
                                    <td>
                                        @if (order.OrderStatus == "Pending")
                                        {
                                            <span class="badge bg-warning">
                                                <i class="fas fa-clock me-1"></i>Pending
                                            </span>
                                        }
                                        else if (order.OrderStatus == "Confirmed")
                                        {
                                            <span class="badge bg-info">
                                                <i class="fas fa-check me-1"></i>Confirmed
                                            </span>
                                        }
                                        else if (order.OrderStatus == "Shipped")
                                        {
                                            <span class="badge bg-primary">
                                                <i class="fas fa-shipping-fast me-1"></i>Shipped
                                            </span>
                                        }
                                        else if (order.OrderStatus == "Delivered")
                                        {
                                            <span class="badge bg-success">
                                                <i class="fas fa-check-circle me-1"></i>Delivered
                                            </span>
                                        }
                                        else if (order.OrderStatus == "Cancelled")
                                        {
                                            <span class="badge bg-danger">
                                                <i class="fas fa-times-circle me-1"></i>Cancelled
                                            </span>
                                        }
                                    </td>

                                    <!-- Actions -->
                                    <!-- Actions -->
                                    <td>
                                        <div class="btn-group-vertical btn-group-sm" role="group">
                                            <a asp-action="OrderDetails" asp-route-id="@order.OrderItemId"
                                               class="btn btn-outline-primary"
                                               title="View Details">
                                                <i class="fas fa-eye"></i> Details
                                            </a>

                                            @if (order.OrderStatus == "Pending")
                                            {
                                                <form asp-action="ConfirmOrder" method="post" class="d-inline">
                                                    <input type="hidden" name="orderItemId" value="@order.OrderItemId" />
                                                    <button type="submit" class="btn btn-outline-success btn-sm w-100 mt-1"
                                                            onclick="return confirm('Confirm this order?')"
                                                            title="Confirm Order">
                                                        <i class="fas fa-check"></i> Confirm
                                                    </button>
                                                </form>
                                            }
                                            else if (order.OrderStatus == "Confirmed")
                                            {
                                                <form asp-action="ShipOrder" method="post" class="d-inline">
                                                    <input type="hidden" name="orderItemId" value="@order.OrderItemId" />
                                                    <button type="submit" class="btn btn-outline-primary btn-sm w-100 mt-1"
                                                            onclick="return confirm('Mark as shipped?')"
                                                            title="Mark as Shipped">
                                                        <i class="fas fa-shipping-fast"></i> Ship
                                                    </button>
                                                </form>
                                            }
                                            else if (order.OrderStatus == "Shipped")
                                            {
                                                <form asp-action="DeliverOrder" method="post" class="d-inline">
                                                    <input type="hidden" name="orderItemId" value="@order.OrderItemId" />
                                                    <button type="submit" class="btn btn-outline-success btn-sm w-100 mt-1"
                                                            onclick="return confirm('Mark as delivered?')"
                                                            title="Mark as Delivered">
                                                        <i class="fas fa-check-double"></i> Deliver
                                                    </button>
                                                </form>
                                            }
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="card shadow-sm">
            <div class="card-body text-center py-5">
                <i class="fas fa-inbox fa-5x text-muted mb-4"></i>
                <h4 class="mb-3">No @(currentStatus == "All" ? "" : currentStatus) Orders Found</h4>
                <p class="text-muted">
                    @if (currentStatus == "All")
                    {
                        <text>You haven't received any orders yet.</text>
                    }
                    else
                    {
                        <text>No orders with "@currentStatus" status at the moment.</text>
                    }
                </p>
                <a asp-action="Dashboard" class="btn btn-primary mt-3">
                    <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                </a>
            </div>
        </div>
    }
</div>

<style>
    .nav-pills .nav-link {
        color: #495057;
        margin-right: 0.5rem;
    }

    .nav-pills .nav-link.active {
        background-color: #0d6efd;
    }

    .nav-pills .nav-link:hover:not(.active) {
        background-color: #e9ecef;
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0,123,255,0.05);
    }
</style>